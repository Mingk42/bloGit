## MANIFEST.in

오늘은 금요일에 만들었던 FastAPI를 조금 더 정교화하는 작업을 했다.

순서는 아래와 같다.

1. Dockerfile에서 pip install을 requirements.txt가 아니라 github에서 가져오도록 수정
2. model.pkl 파일이 pip install했을 때 같이 포함되도록 수정
3. model.pkl 파일이 설치된 위치를 찾아서 FastAPI에서 이용하도록 수정

#### MANIFEST.in

Dockerfile에서 pip install을 github로 수정하는 것은 아주 간단한 작업이었다.
```
# RUN pip install --no-cache-dir --upgrade -r /code/requirements.txt
RUN pip install --no-cache-dir git+<github url>@<branch name>
```

그 다음은 pip install 했을 때 model.pkl 파일이 같이 포함되도록 하는 것이었다.

먼저 pkl파일이 어디에 설치되는지 위치를 알 수 있도록 임의의 파일을 하나 만들고 해당 파일이 위치한 경로를 반환하도록 함수를 추가해준다.
```python
def get_model_path():
    import os

    abspath = os.path.dirname(os.path.abspath(__file__))

    return os.path.join(abspath, "model.pkl")
```

그리고 git에 push해주고 docker를 build해본다.

```bash
$ git add .
$ git commit -m "commit msg"
$ git push

$ sudo docker build --no-cache -t fishmlserv:v0.7.0 .
$ sudo docker run -d -p <port>:8080 --name <container name> fishmlserv:v0.7.0
$ sudo docker exec -it <container id> bash

#################### container bash #############################
$ python
>>> from fishmlserv.model.<python file name> import get_model_path
>>> get_model_path()
/usr/local/lib/python3.9/site-packages/fishmlserv/model/model.pkl

>>> exit()

$ cd /usr/local/lib/python3.9/site-packages/fishm미"
            }

    return {
            "prediction":CLASSES[pred],
            # "prediction":get_model_path(),
            "length":length,
            "weight":weight
            }
```

#### 모델 평가하기

평가용 데이터를 주셨는데, 해당 파일의 갯수가 10,000,000개라서 도저히 돌아가지가 않습니다.



돌아가면 내용 추가하겠습니다.


### 정리

오늘은 파이썬을 패키징할 때 .py 확장자가 아닌 파일을 추가하는 방법을 알아보았다.

점점 무언가를 제공하는 사람이 되고 있는 듯한 기분이다. 많은 것을 알게 되어 재미있다.
