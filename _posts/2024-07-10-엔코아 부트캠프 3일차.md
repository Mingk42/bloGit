## 협업도구로써의 Git 그리고 셸 스크립트

오늘도 현업에서 실제 일어날 법한 이야기로 강의가 시작되었다.

개발 - 배포 - 운영이라는 cycle을 가지고 있는데, 안정적인 운영이 중요하다는 말씀이었다. 그리고 대부분 운영은 Linux 환경에서 이루어진다는 말씀을 해주셨다. Linux를 배우는 직접적인 목적이 이거였나보다.

그리고 git에 대해서도 이야기를 해주셨다. git은 기본적으로 코드관리, 버전관리, 형상관리 (3가지는 사실상 동치이다)이지만, 협업툴로써 가치가 있다고. 줄곧, 협업에 대해서 많은 강조를 하신다. 개발자는 대다수가 협동하여 하는 일이기 때문에 그럴 것이다.

자투리 이야기로 기술블로그는 일반적으로 채용의 목적을 가진다고 이야기해주셨다. 기술블로그의 최종 컨펌은 기술팀이 아니라 채용팀이 한다고??? 흥미로운 이야기다. 

안정적인 운영을 위한 전략으로 카나리 배포 전략에 대해서 얘기하셨다. 2개의 서버를 두고 하나는 대기 상태(접속X), 하나는 운영 상태로 둔다. 그리고 패치가 일어나면 대기 상태의 서버에 패치버전을 올리고 운영 상태로 전환, 운영 상태였던 서버를 대기 상태로 전환하는 것이다. 이렇게 하면 장애 발생 시 다시 각 서버의 운영 상태만 전환하면 온전하게 서버가 돌아가는 상태가 되므로, 장애시간을 최소화할 수 있게 된다.  참고로 카나리아는 새라고 하는데 무슨 연관일까?? 

안정성에 대한 이야기의 연장으로 브이모델에 대해서도 살짝 언급하시면서 모든 요구사항은 테스트될 수 있어야 한다고 하셨다. 테스트될 수 있다는 것은 운영상의 안정성을 보장할 수 있다는 의미라고. 그러고 보니 정보처리기사 자격증 공부를 할 때 그리고 대학원에서 소프트웨어 테스팅 수업에서 브이모델에 대해 자세히 배운 것이 언뜻 떠올랐다. 

그리고 파일을 수정하려고 하는 것이 아니라면 vi로 파일을 여는 것보다 cat, tail 등으로 파일을 열람하는 게 좋다는 말씀도 하셨다. 의도치 않은 문자가 기록될 수 있기 때문이다. 이것도 좋은 말씀인 것 같다.

#### Linux에서 프로그램 설치 오류

directory의 tree구조를 보기 위해 tree라는 프로그램을 사용해보자고 하셨다. 
해당 프로그램은 기본 프로그램은 아니라서 별도로 설치를 해야 했다.

```bash
sudo apt install tree
```

설치 대기…

삐빅 오류발생  

```bash
E: Unable to locate package tree
```

프로그램 설치에서 오류가 나서 조금 당황했다. 이럴 땐 당황하지 말고 구글링

 [해결법](https://velog.io/@sangeun-jo/E-Unable-to-locate-package)

요약하면 특정한 내용을 추가하면 해결된다고 한다. 그리고 조금 더 구글링 해 본 결과 해당 글에는 `apt-get update`라고 되어있는 부분을 `sudo`로 수행해야 정상적으로 동작하는 것으로 확인했다.

#### git 확장

git의 기능을 좀 더 확장해서 사용해보는 시간을 가졌다. 

협업을 위해 필수적인 `pull request`에 대해 배워보는 시간이었다.

이를 위해서 `git pull`과 `git branch`에 대해서 알아야 했다.

먼저 `git pull`은 어제 학습한 `git push`의 반대로 볼 수 있다. (단어 자체가 반대이기도 하다😂)
어제 학습한 push가 로컬에서 작업한 것을 github(협업이 이루어지는 공간의 대명사로써)로 올리는 것이라고 한다면, pull은 github에 있는 것을 로컬로 가져오는 작업이었다. github에 main으로써 push되어있는 버전이 최신버전이라고 할 수 있으므로 협업이 잘 이루어질 수 있도록 수시로 `git pull`을 할 것을 강조하셨다.  

그리고 branch라는 개념도 알게 되었는데, branch는 말 그대로 하나의 분기를 의미했다. 각 기능별로 branch를 만들어 추후 하나의 완성된 프로그램으로 만들 수 있도록 관리하는 것이다. 이렇게 되면, 문제가 발생한다든가 특정 기능을 폐기하기로 한 경우 처음부터 모두 main으로만 관리하는 것보다  더 쉽게 수정 및 폐기를 할 수 있게 된다. 

또, release도 해보면서 tag에 대해 학습했다. tag를 생성하면 일종의 snapshot을 구성하게 되어 특정 시점으로 rollback하는 것이 가능하게 한다. 

첨언으로 `pull request`는 `pull을 요청한다`는 의미로, `*내 코드를 가져가주세요`* 라는 아주 정중한 의미를 내포하고 있다는 이야기도 해주셨다.

그리고 어제는 `git commit -m`  만 했었는데 오늘은 다른 옵션을 사용해보았다.

```bash
git commit -a        # all, 
                     # 해당 옵션으로 commit을 하는 경우 commit message를 넣을 수 있도록 text editor가 띄워진다.
                     # 맨 윗줄에 입력한 것은 github에서 제목으로, 한 줄 공백 후 입력한 것은 description으로 매칭된다.

git commit --amend   # commit message를 수정할 수 있다.

git tag                
```

그 후에는 `pull`하고 `branch`를 만들고 `push`하는 것을 수 차례 반복하여 연습했다.

```bash
git pull
git branch <branch name>
git checkout <branch name>       # branch name에 -를 넣으면 방금 전 위치했던 branch로 이동 가능 (toggle)
vi README.md                     # 어떤 것을 적용할건지 readme를 수정하여 push하고 개발 방향을 컨펌한 뒤 기능을 개발해야 한다고 강조
git add README.md
git commit -a
##### commit message 작성, markdown 적용가능
git push --set-upstream origin <branch name>  # 최초 push에서는 --set-upstream을 해야함
.
.
.
git pull
vi ooo.ooo                       # 기능 개발
git add ooo.ooo
git commit -m "기능 개발"
git push
```

그리고 연습의 연장으로 원격으로 저장소에 접근하는 방법에 대해서도 알게 되었다. 

```bash
git branch -a                    # all, 원격저장소에 있는 것을 포함하여 모든 branch를 조회할 수 있다.
git checkout -t                  # track, 원격저장소에 있는 branch로 접근할 수 있다.
```

#### Markdown

github를 협업도구로써 잘 이용하기 위해 markdown문법에 대해서 학습할 것을 권장하셨다.
해쉬태그를 이용해서 글자크기를 조절할 수 있다든가 블래킷을 이용하여 체크박스를 만드는 것 정도는 알고 있었는데 콜론을 이용해서 이모지를 삽입하는 것은 처음 알게 되어 매우 흥미로웠다.

#### 셸 스크립트 작성

셸 스크립트도 만들어보았다.

```bash
vi sleeptimer.sh
	#! /bin/bash
	
	echo "-----------------------------"
	date
	sleep 1
	date
	sleep 1
	date
	sleep 1
	date
	echo "-----------------------------"
	
chmod 755 sleeptimer.sh               # 기본적으로 생성된 파일은 읽기/쓰기만 권한이 주어지므로 실행 권한을 부여해야 한다.
./sleeptimer.sh                       # ./을 붙이지 않고 바로 파일명을 입력하면, command로 인식하여 실행되지 않는다.
                                      # 명시적으로 sh sleeptimer.sh로 실행하는 것도 가능하다
```

여기서 `#!/bin/bash` 는 `bash`로 실행한다는 의미로, 적지 않으면 기본 셸로 스크립트를 실행하게 된다.  이렇게 어떤 쉘로 실행할지 적는 부분을 `셔뱅`이라고 부른다.

또한 위의 기능은 아래와 같이 적을 수도 있다.

```bash
echo "-----------------------------"
date;sleep 1;date;sleep 1;date;sleep 1;date
echo "-----------------------------"
```

그리고 생성된 파일은 아래와 같이 `link`를 걸 수 있었다.

```bash
ln -s <link될 파일> <link name>
```

이는 Windows의 바로가기와 대응되는 기능 이다.

마지막으로 셸 스크립트를 정리하는 과제를 내주셨다. 특정 파일이 존재하면 특정 문구를 띄우는 것이었다. 

```bash
#!/bin/bash

FILE=~/tmp/_SUDDEN

while true
do
#        if -e "$FILE"; then                  # 괄호가 필수인지 궁금해서 안 쓰고 해봤는데 -e:not found 오류가 나타났다.
#        if [-e "$FILE"]; then                # 괄호를 적었는데 다시 [-e:not found 오류가 나타났다. 괄호&공백이 필수인 것으로 확인
        if [ -e "$FILE" ]; then               # 정상적으로 동작!!!
                echo "SUDDEN!!!"
        fi
        echo "check"
        sleep 3
done
```

### 정리

오늘은 pull request를 포함하여 몰랐던 기능을 많이 알게 됐다. git을 사용해봤더라도 혼자만 써봐서 아무래도 협업할 때 사용하게 될 기능에 대해서는 사용해볼 기회가 없었고, 부족함을 느낄 기회도 없었어서 알아보지 않았던 것 같다. 

몰랐던 것들을 많이 알게 돼서 재밌는 하루였다.
