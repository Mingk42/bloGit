## caching (2)

#### caching (2)

오늘도 어제에 이어서 캐시를 이용한 부하테스트를 진행하였다. 어제와 다른 점이 있다면, 어제는 캐시의 유무를 비교하여 테스트를 진행했다면 오늘은 캐시의 시간에 따른 테스트를 진행하였다.

일단 결과부터 확인해보자. 

<img src="https://github.com/user-attachments/assets/3fe9d6fd-cbc3-48d9-b1f7-080a90ee3f60" width="75%"/>
<img src="https://github.com/user-attachments/assets/0022eb61-9447-467c-9c30-e1466bb94807" width="75%"/>

2번의 테스트 모두 2agent, 5 processor, 70 thread로 총 700 가상유저가 동시접속하는 상황으로 진행되었다. 1번 째 테스트는 캐시 시간(proxy_cache_valid)이 5초일 때와 10초일 때를 비교하였고, 2번 째 테스트는 캐시 시간이 30초일 때와 60초일 때를 비교하였다. 그리고 테스트 결과는 예상과 다르게 캐시 시간이 2배가 되어도 성능에 큰 차이를 보이지는 않았다. 오히려 MTT는 늘어나는 경향을 보이기도 하였는데 agent로 사용된 환경에서 다른 프로그램이 돌아가고 있었던 것은 아닌지, 온전하게 성능 테스트를 진행할 수 있는 환경이었는지 확인해볼 필요가 있을 것 같다. 다만, MTTFB(Mean Time to First Byte, 첫 바이트가 도달하는데 걸리는 평균시간)으로 보면 캐시시간이 2배로 늘어난 경우 더 안정된 그래프를 보이는 것을 확인할 수 있다.


또, 한 가지 더 알아볼 만한 것이 있다.

지금까지 proxy_cache_valid 옵션을 조절하면서 테스트를 진행하였는데, 어제 캐시 설정을 했던 것을 확인해보면 inactive 옵션이 있다. 어제 기술하였지만, 두 옵션은 차이가 있다. 그런데 그것이 맞는지 확인해보고자 한다.

<img src="https://github.com/user-attachments/assets/91c1f42b-ad5b-46e3-a3be-da68b911a802" width="75%"/>

아래의 실험은 inactive 1m, proxy_cache_valid 30s 으로 1분간 테스트하였다. 그리고 2번 째 실험(위)은 inactive 1m, proxy_cache_valid 3m으로 3분 동안 테스트를 진행하였다. 테스트의 진행시간은 중요한 부분은 아니고, 테스트가 시작되자마자 회귀분석 서버를 끄는 것이다. 그리고 남은 테스트 시간동안 정상적으로 테스트가 진행되는지 확인해보는 실험이다. 테스트 결과는 확인해보면 알겠지만, proxy_cache_valid가 30초인 경우 정확히 30초 후부터 응답이 오지 않는 것을 확인할 수 있다. 같은 원리로 proxy_cache_valid이 3분으로 설정된 테스트의 경우 3분 동안 안정적으로 응답이 오는 것을 알 수 있다. 그리고 응답의 안정성 여부에서 inactive 옵션은 크게 작용하지 않는 것도 확인할 수 있다. 이는 테스트를 진행하는 동안에는 계속 요청이 들어오고, inactive로 설정된 시간은 계속 초기화되기 때문에 그렇다고 볼 수 있다.

### 정리

오늘도 부하테스트를 진행하였다. 며칠에 걸친 테스트에서 성능을 높일 수 있는 방법을 많이 테스트해 본 것 같아서 유익한 시간이었던 것 같다.
