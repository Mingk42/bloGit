## FastAPI 부하테스트

#### 부하테스트

오늘은 오랜만에 돌아온 부하테스트 시간이었다.

Docker FastAPI

#### Docker nginx

이번에는 load balance를 하면 성능이 개선되는지 확인하기 위해 docker로 nginx를 띄웠다. 이전에는 직접 nginx를 설치했었는데, docker를 이용하면 직접 설치하지 않고도 사용가능해진다. 

먼저 docker를 이용하여 load balance를 하는 방법은 다음과 같다.

먼저 nginx의 docker image를 build하기 위해 Dockerfile과 default.conf을 생성하였다. 그리고 파일 내용은 아래와 같이 작성하였다.
###### Dockerfile
```
FROM nginx:1.25.1

COPY default.conf /etc/nginx/conf.d/i
```

###### default.conf
```
upstream ml_servers {
    server ml-1:8080;
    server ml-2:8080;
}

server {
    listen 80;

    location /
    {                                                                                                                                                                     proxy_pass http://ml_servers;                                                                                                                                 }                                                                                                                                                             }
```

그리고 어제 생성한 ml image의 container를 먼저 2개 띄웠다. 이 때 중요한 것은 container의 이름을 위 default.conf에 명시한 이름으로 해주어야 한다는 것이다.
```bash
$ sudo docker run -d --name ml-1 fish:v1.1.0
$ sudo docker run -d --name ml-2 fish:v1.1.0
```

```bash
$ sudo docker run -d -p 70:80 --link ml-1 --link ml-2 --name ngx150  nginx:v1.5.0
```

`--link` 

### 정리
