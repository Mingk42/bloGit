## AWS를 통해 2대의 PC를 각각 master-worker로 나누기

#### 2대의 PC를 각각 master-worker로 나누기

전 날에 하던 것을 계속 하는 날이었다. 다만 두 대의 PC를 직접 연결하는 것은 아무래도 복잡하고 번거로운 일이라서 조금의 과금을 무릅쓰고 AWS EC2를 이용하기로 하였다. 

EC2는 Elastic Compute Cloud의 약자로 ECC인데 C가 2번 들어가서 EC2라고 한다고 한다. 같은 원리로 AWS에서 제공하는 storage 서비스인 Simple Storage Service는 S3라고 약칭한다. EC2는 위에 풀네임에서 알 수 있듯 가상의 컴퓨터를 제공해주는 서비스이다. 전 직장에서 사용자들을 위해 VDI를 제공했던 것이 생각나서 쉽게 이해할 수 있었다. EC2는 IP가 2개 존재하는데 하나는 private이고 하나는 public이다. 

다른 사람과 연결을 해보기 전에 혼자서 잘 돌아가는지 테스트를 해봤다. 제공된 EC2 환경은 1core - 1G였다. 혹시 몰라서 memory는 512M만 사용하도록 제한을 해서 원래 로컬에서 사용하던 스크립트를 실행해봤는데 경고만 올라가고 정상 실행되지 않았다. 해당 경고는 어떠한 자원도 할당받지 못했다는 것인데, 검색해보니 master와 worker가 연결되지 않은 경우 발생할 수 있다고 한다. 하지만, 아무리 봐도 연결은 정상이었다. 그래서 실행중인 스크립트를 멈추고 다시 실행해봐도 같은 현상이 나타났다. 그래서 혹시 메모리의 문제가 아닐까 싶어서 메모리를 제한하지 않고 실행한 결과! EC2가 멈춰버렸다. worker가 자원을 모두 할당받으면서 os가 시스템을 유지하기 위해 사용해야하는 메모리까지 침범해서 그런 것이라고 한다. 그래서 EC2를 재기동하고 다시 메모리를 제한하고 스크립트를 실행했는데 역시 동알한 결과를 나타냈다. 그런데 한 가지가 눈에 띄었다. WebUI에서 확인해보면, 내가 worker를 위해 할당한 메모리는 512M인데 Executor는 1G를 사용한다고 나타나있었다. 이것의 문제였다는 생각이 강하게 들었다. 그리고 찾아본 결과 `--executor-memory` 옵션을 이용하면 executor가 사용하는 메모리를 조정할 수 있다고 나타났다. 그래서 사용해본 결과! 정상 동작했다.

정상 동작을 확인하고 다른 사람과 worker와 master의 역할을 나누어 연결을 해보았고 실행도 잘 되는 것을 확인하였다. 이런 것이 모이면 강력한 cluster가 될 수 있겠다는 것이 어림짐작되었다.

### 정리

처음 실행에서 시행착오가 있었지만 그래서 또 보람있는 하루였던 것 같다.
