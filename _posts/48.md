## 대제목



#### 소제목

```bash
server_names_hash_bucket_size 128;

server {
    listen 80;
    server_name 3.38.255.160;

    # sudo docker run -d -p 8001:8080 --name how_serv <IMAGE>
    location /reg/ {
        proxy_pass http://172.17.0.1:8001/;
    }

    # sudo docker run -d -p 8002:8080 --name kind_serv <IMAGE>
    location /cls/ {
        proxy_pass http://172.17.0.1:8002/;
    }
}


server {
    listen 80;
    server_name kind.naver.com;

    location / {
        proxy_pass http://172.17.0.1:8002/;
    }
}


proxy_cache_path /etc/nginx/cache levels=1:2 keys_zone=my_cache:10m max_size=100m inactive=1m use_temp_path=off;
log_format cache '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" cs=$upstream_cache_status';

server {
    listen 80;
    # server_name ec2-3-38-255-160.ap-northeast-2.compute.amazonaws.com;
    # server_name how.naver.com;
    server_name 172.31.6.145;

    ## Access and error logs.
    access_log /var/log/nginx/api-proxy.access.log cache;
    error_log  /var/log/nginx/api-cache.error.log;


            #    location / {
            #        proxy_pass http://172.17.0.1:8001/;
            #    }
    location /cache/ {
        proxy_pass http://172.17.0.1:8001/;

        # proxy_ignore_headers X-Accel-Expires Expires Cache-Control;
        proxy_cache_valid 200 302 5s;
        proxy_cache_valid 404 1m;

        proxy_cache my_cache;
    }

    location /nocache/ {
        proxy_pass http://172.17.0.1:8001/;
    }
}
```

```bash
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21
$ curl  http://172.31.6.145:8080/cache/fish?length=21

172.31.6.145 - - [11/Sep/2024:06:45:30 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=MISS
172.31.6.145 - - [11/Sep/2024:06:45:34 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:34 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:35 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:36 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=EXPIRED
172.31.6.145 - - [11/Sep/2024:06:45:36 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:37 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:38 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=HIT
172.31.6.145 - - [11/Sep/2024:06:45:43 +0000] "GET /cache/fish?length=21 HTTP/1.1" 200 47 "-" "curl/8.5.0" cs=EXPIRED
```

```bash
$ sudo docker commit <container name> <image name>:<tag>
```

### 정리
